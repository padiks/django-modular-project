{% extends 'base.html' %}

{% block title %}Alpine.js - Client-Side Calculation{% endblock %}

{% block content %}
<!-- Include Alpine.js CDN in the template itself -->
<script src="https://cdn.jsdelivr.net/npm/alpinejs@2.8.2/dist/alpine.min.js" defer></script>

<div class="card shadow-lg p-4 mb-3">
	<h4 class="mb-4 text-center">Alpine.js - Client-Side Calculation</h4>

    {% block nav %}
        {% include 'includes/_compute_nav.html' %}
    {% endblock %}

    <div class="mt-3" x-data="{
            items: [
                { name: 'Item 1', qty: '', price: '' },
                { name: 'Item 2', qty: '', price: '' },
                { name: 'Item 3', qty: '', price: '' },
                { name: 'Item 4', qty: '', price: '' },
                { name: 'Item 5', qty: '', price: '' }
            ],
            getTotal() {
                const total = this.items.reduce((sum, item) => sum + (item.qty * item.price || 0), 0);
                return total.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            },
            nextInput(currentInput) {
                const inputs = Array.from(currentInput.closest('tr').querySelectorAll('input'));
                const currentIndex = inputs.indexOf(currentInput);
                if (currentIndex + 1 < inputs.length) {
                    inputs[currentIndex + 1].focus();
                }
            }
        }">

        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th scope="col">Item</th>
                    <th scope="col" class="text-end">Qty</th>
                    <th scope="col" class="text-end">Price</th>
                    <th scope="col" class="text-end">Amount</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="(item, index) in items" :key="index">
                    <tr>
                        <td x-text="item.name"></td>
                        <td class="text-end">
                            <!-- Editable quantity input, starts empty, press Enter to go to price -->
                            <input 
                                type="number" 
                                x-model="item.qty" 
                                class="form-control" 
                                min="0" 
                                placeholder="Enter quantity"
                                @keydown.enter="nextInput($event.target)" />
                        </td>
                        <td class="text-end">
                            <!-- Editable price input, starts empty, press Enter to go to next quantity -->
                            <input 
                                type="number" 
                                x-model="item.price" 
                                class="form-control" 
                                min="0" 
                                step="0.01" 
                                placeholder="Enter price"
                                @keydown.enter="nextInput($event.target)" />
                        </td>
                        <td class="text-end" x-text="(item.qty * item.price || 0).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })"></td>
                    </tr>
                </template>
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="3" class="text-end">Total</th>
                    <td class="text-end fw-bold" x-text="getTotal()"></td>
                </tr>
                <tr>
                    <th colspan="3" class="text-end">
                        <button 
                            type="button" 
                            class="btn btn-danger"
                            @click="items.forEach(item => { item.qty = ''; item.price = ''; })">
                            Clear
                        </button>
                    </th>
                </tr>
            </tfoot>
        </table>
    </div>
</div>
{% endblock %}
